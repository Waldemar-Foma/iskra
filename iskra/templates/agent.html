<!-- templates/agent.html - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å AI-–º—ã—Å–ª—è–º–∏ -->
{% extends "base.html" %}

{% block content %}
<div class="agent-detail-container">
    <div class="agent-detail-header">
        <a href="{{ url_for('world') }}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –º–∏—Ä—É</a>
        <h1>–ê–≥–µ–Ω—Ç: <span class="accent">{{ agent.name }}</span></h1>
    </div>

    <div class="agent-detail-grid">
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="agent-info-card">
            <h2>–°—Ç–∞—Ç—É—Å</h2>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">–¢–∏–ø</span>
                    <span class="info-value type-badge {{ agent.type.lower() }}">{{ agent.type }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span>
                    <span class="info-value mood-badge" data-mood="{{ agent.mood }}">{{ agent.mood }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–≠–Ω–µ—Ä–≥–∏—è</span>
                    <div class="energy-display">
                        <div class="energy-bar-large">
                            <div class="energy-fill" style="width: {{ agent.energy * 100 }}%"></div>
                        </div>
                        <span>{{ "%.0f"|format(agent.energy * 100) }}%</span>
                    </div>
                </div>
                <div class="info-item">
                    <span class="info-label">–ü–æ–∑–∏—Ü–∏—è</span>
                    <span class="info-value">({{ "%.2f"|format(agent.position_x) }}, {{ "%.2f"|format(agent.position_y) }}, {{ "%.2f"|format(agent.position_z) }})</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–°–æ–∑–¥–∞–Ω</span>
                    <span class="info-value">{{ agent.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–ê–∫—Ç–∏–≤–µ–Ω</span>
                    <span class="info-value">{{ time_ago(agent.last_active) }}</span>
                </div>
            </div>
        </div>

        <!-- AI –ú—ã—Å–ª–∏ -->
        <div class="agent-thoughts-card">
            <h2>ü§ñ –ì–ª—É–±–æ–∫–∏–µ –º—ã—Å–ª–∏ (AI)</h2>
            <div class="thoughts-list">
                {% for thought in thoughts %}
                <div class="thought-item" data-significance="{{ thought.significance }}">
                    <div class="thought-header">
                        <span class="thought-type">{{ thought.thought_type }}</span>
                        <span class="thought-time">{{ time_ago(thought.timestamp) }}</span>
                        <span class="thought-cycle">–¶–∏–∫–ª {{ thought.world_cycle }}</span>
                    </div>
                    <div class="thought-content">"{{ thought.thought }}"</div>
                    <div class="thought-significance">
                        <div class="significance-bar" style="width: {{ thought.significance * 100 }}%"></div>
                        <span class="significance-label">–ó–Ω–∞—á–∏–º–æ—Å—Ç—å: {{ "%.0f"|format(thought.significance * 100) }}%</span>
                    </div>
                </div>
                {% else %}
                <div class="empty-state">
                    <span class="empty-icon">ü§î</span>
                    <p>–ê–≥–µ–Ω—Ç –ø–æ–∫–∞ –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –≥–ª—É–±–æ–∫–∏—Ö –º—ã—Å–ª–µ–π</p>
                    <small>–ú—ã—Å–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∫–æ–≥–¥–∞ –∞–≥–µ–Ω—Ç —Ä–∞–∑–º—ã—à–ª—è–µ—Ç –æ —Å–≤–æ–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏</small>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- –í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
        <div class="agent-memories-card">
            <h2>üß† –í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è</h2>
            <div class="memories-list">
                {% for memory in memories %}
                <div class="memory-item" data-significance="{{ memory.significance }}">
                    <div class="memory-header">
                        <span class="memory-type">{{ memory.memory_type }}</span>
                        <span class="memory-time">{{ time_ago(memory.timestamp) }}</span>
                    </div>
                    <div class="memory-content">{{ memory.content }}</div>
                    <div class="memory-significance">
                        <div class="significance-bar" style="width: {{ memory.significance * 100 }}%"></div>
                    </div>
                </div>
                {% else %}
                <div class="empty-state">–ù–µ—Ç –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π</div>
                {% endfor %}
            </div>
        </div>

        <!-- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="agent-interactions-card">
            <h2>üí¨ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è</h2>
            <div class="interactions-list">
                {% for interaction in interactions %}
                <div class="interaction-item">
                    <span class="interaction-time">{{ time_ago(interaction.timestamp) }}</span>
                    <span class="interaction-text">{{ interaction.event_text }}</span>
                </div>
                {% else %}
                <div class="empty-state">–ù–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π</div>
                {% endfor %}
            </div>
        </div>

        <!-- –û—Ç–Ω–æ—à–µ–Ω–∏—è -->
        <div class="agent-relationships-card">
            <h2>üï∏Ô∏è –û—Ç–Ω–æ—à–µ–Ω–∏—è</h2>
            <div class="relationships-canvas" id="relationshipCanvas"></div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –¥–ª—è –∞–≥–µ–Ω—Ç–∞
    fetch('/api/graph-data')
        .then(response => response.json())
        .then(data => {
            const agentName = "{{ agent.name }}";
            const relationships = data.links.filter(link => 
                link.source === agentName || link.target === agentName
            );
            
            const canvas = document.getElementById('relationshipCanvas');
            if (!canvas || relationships.length === 0) {
                canvas.innerHTML = '<div class="empty-state">–ù–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π</div>';
                return;
            }
            
            // –ü—Ä–æ—Å—Ç–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
            const html = relationships.map(rel => {
                const other = rel.source === agentName ? rel.target : rel.source;
                const value = rel.value;
                const color = value > 0 ? '#2ecc71' : '#e74c3c';
                const icon = value > 0 ? 'ü§ù' : '‚ö°';
                
                return `
                    <div class="relationship-item">
                        <span class="relationship-icon">${icon}</span>
                        <span class="relationship-other">${other}</span>
                        <div class="relationship-bar-container">
                            <div class="relationship-bar" style="width: ${Math.abs(value) * 100}%; background: ${color}"></div>
                        </div>
                        <span class="relationship-value">${value > 0 ? '+' : ''}${value.toFixed(2)}</span>
                    </div>
                `;
            }).join('');
            
            canvas.innerHTML = html;
        })
        .catch(console.error);
});
</script>

<style>
.agent-detail-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--spacing-lg);
}

.agent-detail-header {
    margin-bottom: var(--spacing-xl);
}

.back-link {
    color: var(--text-secondary);
    text-decoration: none;
    display: inline-block;
    margin-bottom: var(--spacing-md);
    transition: color var(--transition-fast);
}

.back-link:hover {
    color: var(--primary);
}

.agent-detail-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-lg);
}

.agent-info-card,
.agent-thoughts-card,
.agent-memories-card,
.agent-interactions-card,
.agent-relationships-card {
    background: var(--surface);
    border: 1px solid rgba(2, 124, 125, 0.3);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-lg);
}

.agent-thoughts-card {
    grid-column: span 2;
}

.agent-thoughts-card h2,
.agent-memories-card h2,
.agent-interactions-card h2,
.agent-relationships-card h2 {
    color: var(--primary);
    margin-bottom: var(--spacing-lg);
    font-size: 1.3rem;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-md);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    color: var(--text-muted);
    font-size: 0.9rem;
}

.info-value {
    font-size: 1.1rem;
    font-weight: 500;
}

.type-badge.–±–∞–∑–æ–≤–∞—è { color: #027C7D; }
.type-badge.–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è { color: #E6006A; }
.type-badge.–±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è { color: #9b59b6; }

.mood-badge[data-mood="–ª—é–±–æ–ø—ã—Ç–Ω—ã–π"] { color: #2ecc71; }
.mood-badge[data-mood="–≤–æ–∑–±—É–∂–¥–µ–Ω–Ω—ã–π"] { color: #f1c40f; }
.mood-badge[data-mood="—É—Å—Ç–∞–≤—à–∏–π"] { color: #9b59b6; }
.mood-badge[data-mood="—Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π"] { color: #3498db; }
.mood-badge[data-mood="–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π"] { color: #95a5a6; }

.energy-display {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.energy-bar-large {
    flex: 1;
    height: 12px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    overflow: hidden;
}

.thoughts-list,
.memories-list,
.interactions-list {
    max-height: 400px;
    overflow-y: auto;
}

.thought-item,
.memory-item,
.interaction-item {
    padding: var(--spacing-md);
    border-bottom: 1px solid rgba(2, 124, 125, 0.1);
    transition: background var(--transition-fast);
}

.thought-item:hover,
.memory-item:hover,
.interaction-item:hover {
    background: rgba(230, 0, 106, 0.05);
}

.thought-header,
.memory-header {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-xs);
    font-size: 0.9rem;
}

.thought-type,
.memory-type {
    color: var(--primary);
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
}

.thought-time,
.memory-time,
.interaction-time {
    color: var(--text-muted);
    font-size: 0.8rem;
}

.thought-cycle {
    color: var(--secondary);
    font-size: 0.8rem;
}

.thought-content {
    color: var(--text);
    font-style: italic;
    margin-bottom: var(--spacing-sm);
    line-height: 1.5;
}

.thought-significance,
.memory-significance {
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
}

.significance-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--secondary), var(--primary));
}

.significance-label {
    position: absolute;
    right: 0;
    top: -20px;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.interaction-item {
    display: flex;
    gap: var(--spacing-md);
    align-items: flex-start;
}

.interaction-text {
    flex: 1;
}

.empty-state {
    text-align: center;
    padding: var(--spacing-xl);
    color: var(--text-muted);
}

.empty-icon {
    font-size: 3rem;
    display: block;
    margin-bottom: var(--spacing-md);
}

.relationships-canvas {
    min-height: 200px;
}

.relationship-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-sm) 0;
    border-bottom: 1px solid rgba(2, 124, 125, 0.1);
}

.relationship-icon {
    font-size: 1.2rem;
    width: 30px;
}

.relationship-other {
    flex: 1;
    color: var(--text);
}

.relationship-bar-container {
    flex: 2;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
}

.relationship-bar {
    height: 100%;
    transition: width 0.3s ease;
}

.relationship-value {
    min-width: 50px;
    text-align: right;
    color: var(--text-secondary);
    font-family: monospace;
}

@media (max-width: 768px) {
    .agent-detail-grid {
        grid-template-columns: 1fr;
    }
    
    .agent-thoughts-card {
        grid-column: span 1;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
    }
    
    .thought-header {
        flex-wrap: wrap;
    }
}
</style>
{% endblock %}